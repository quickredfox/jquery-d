/***
jquery-d  0.0.1
    
exports "D" which proxies jQuery.Deferred adding a few utility methods to handle promises.
    
Copyright 2011 Francois Lafortune, quickredfox &lt;code@quickredfox.at&gt; (http://about.me/quickredfox)
***/
(function(){var a,b,c,d,e,f,g,h,i,j,k;f=typeof process!="undefined"&&process.versions&&!!process.versions.node,f?a=g=require("jquery"):a=g=window.jQuery,b=function(b){return a.Deferred.call(this,b)},b.prototype=a.Deferred.prototype,b.version="v0.0.1",e=function(a){return Array.prototype.slice.call(a)},d=function(a){return a.map(function(a){return b.isPromise(a)?a:b().resolveWith(null,a).promise()})},j=function(a,b){typeof a=="undefined"&&(a=[]),a.push(b);return a},i=function(a,b){typeof a=="undefined"&&(a=[]),a.push(b);return a},k=function(a,c,d,e,f,g){var h;a==null&&(a=[]),c==null&&(c=b()),d==null&&(d=!1),e==null&&(e=j),f==null&&(f=i),g==null&&(g={values:[],errors:[]});if(a.length===0)return c.resolveWith(null,[g.values]).promise();h=a.shift(),h.done(function(a){return g.values=e(g.values,a)}),h.fail(function(a){return g.errors=f(g.errors,a)});return h.always(function(){return h.isRejected()&&!d?c.rejectWith(null,[g.errors]):a.length!==0?k(a,c,d,e,f,g):g.errors.length===0?c.resolveWith(null,[g.values]):c.rejectWith(null,[g.errors])})},h=function(a,c,d,e,f,g,h){a==null&&(a=[]),c==null&&(c=b()),d==null&&(d=!0),e==null&&(e=null),f==null&&(f=0),g==null&&(g=[]),h==null&&(h=[]),e=e===null?a.length:e,a.forEach(function(a){a.done(function(a){return g.push(a)}),a.fail(function(a){h.push(a);if(d===!1)return c.rejectWith(null,[h])});return a.always(function(){if(++f===e)return d?c.resolveWith(null,[g.reduce(function(a,b){return a||b}),h.reduce(function(a,b){return a||b})]):h.length===0?c.resolveWith(null,[g]):c.rejectWith(null,[h])})});return c.promise()},c=function(c){var d,e,f;d=b(),f=d.promise(),e=!1,a.extend(f,["done","then","fail","always"].reduce(function(a,f){var g;g=a[f],a[f]=function(){var h;if(!e){e=!0;try{h=c.call(null,d)}catch(i){return d.rejectWith(null,[i])}b.isPromise(h)?(h.done(function(){return d.resolveWith(null,arguments)}),h.fail(function(){return d.rejectWith(null,arguments)})):typeof h=="function"?d.rejectWith(null,[new TypeError("negociators cannot return functions")]):d.resolveWith(null,[h])}a[f]=g;return a[f].apply(a[f],arguments)};return a},f));return f},b.isPromise=function(a){return Boolean(a&&a.promise&&"function"==typeof a.promise&&a.promise().promise)},b.isDeferred=function(a){return Boolean(a&&a.resolveWith&&"function"==typeof a.resolveWith&&a.rejectWith&&"function"==typeof a.rejectWith)},b.step=function(a){var c;a=d(a),c=b(),k(a,c);return c.promise()},b.parallel=function(a){var c;a=d(a),c=b(),h(a,c,!1);return c.promise()},b.through=function(a){var c;a=d(a),c=b(),k(a,c,!0);return c.promise()},b.reduce=function(a,c,e){var f,g,h;c==null&&(c=j),e==null&&(e=i),a=d(a),g=b(),h=function(){var a;a=null;try{return a=c.apply(null,arguments)}catch(b){return g.rejectWith(null,[b])}},f=function(){var a;a=null;try{return a=e.apply(null,arguments)}catch(b){return g.rejectWith(null,[b])}},k(a,g,!0,h,f);return g.promise()},b.negociate=function(a){var b;if(typeof a!="function")throw new TypeError("negociate expects a negociator function");b=c(a);return b},b.resolved=function(a){var c;if(b.isPromise(a)&&a.isResolved())return a;c=b(),c.resolveWith(null,[a]);return c.promise()},b.rejected=function(a){var c;if(b.isPromise(a)&&a.isRejected())return a;c=b(),c.rejectWith(null,[a]);return c.promise()},b.deep=function(c){var d,e;d=b(),e=[],(a.isPlainObject(c)||a.type(c)==="array")&&a.each(c,function(d,f){if(b.isPromise(f)){f.done(function(a){return c[d]=a}),f.fail(function(a){return c[d]=new Error("deep promise failed: "+a)});return e.push(f)}if(a.isPlainObject(c)||a.type(c)==="array")return e.push(b.deep(f))}),b.through(e).then(function(){return d.resolveWith(null,[c])},function(a){return d.rejectWith(null,[a,c])});return d.promise()},b.delay=function(a,c){var d;d=b(),a.done(function(){var a;a=e(arguments);return setTimeout(function(){return d.resolveWith(null,a)},c)}),a.fail(function(){var a;a=e(arguments);return setTimeout(function(){return d.rejectWith(null,a)},c)});return d.promise()},b.timeout=function(a,c){var d,e;e=b(),d=setTimeout(function(){return e.rejectWith(null,["timeout"])},c),a.done(function(){clearTimeout(d);return e.resolveWith(null,arguments)}),a.fail(function(){return e.rejectWith(null,arguments)});return e.promise()},f?(a.D=module.exports=b,a.D.prototype=module.exports.prototype=b.prototype):(a.D=b,a.D.prototype=b.prototype)}).call(this)